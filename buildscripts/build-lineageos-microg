#!/usr/bin/env bash
set -eo pipefail

PROJECT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")/.." && pwd)"

source "$PROJECT_DIR/scripts/bootstrap"
source "$PROJECT_DIR/scripts/modules/workdir.sh"
source "$PROJECT_DIR/scripts/modules/manifests.sh"
source "$PROJECT_DIR/scripts/modules/userscripts.sh"
source "$PROJECT_DIR/scripts/modules/docker.sh"

check_deps
require_var DEVICE_LIST
require_var BRANCH_NAME
: "${ROOT_METHOD:=none}"

export_config
export ROOT_METHOD

workdir_init "microg"
local_manifests_clear
local_manifests_write_microg
userscripts_write_before_sh

docker_run_lineage "true"
