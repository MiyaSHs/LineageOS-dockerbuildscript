#!/usr/bin/env bash
set -euo pipefail

prompt_nonempty() {
  local var_name="$1"
  local prompt="$2"
  local default="${3:-}"
  declare -n ref="$var_name"

  while [[ -z "${ref}" ]]; do
    if [[ -n "$default" ]]; then
      read -rp "$prompt [$default]: " ref
      ref="${ref:-$default}"
    else
      read -rp "$prompt: " ref
    fi
  done
}

prompt_choice() {
  local var_name="$1"
  local prompt="$2"
  shift 2
  local options=("$@")
  declare -n ref="$var_name"

  echo
  echo "$prompt"
  local i=1
  for opt in "${options[@]}"; do
    echo "  $i) $opt"
    ((i++))
  done

  while true; do
    read -rp "Choose [1-${#options[@]}]: " choice
    [[ "$choice" =~ ^[0-9]+$ ]] || continue
    (( choice >= 1 && choice <= ${#options[@]} )) || continue
    ref="${options[$((choice-1))]}"
    break
  done
}
